<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nduduzo Nkosikhona · portfolio</title>
    <!-- Font Awesome (free icons) for optional mic / send enhancement, no extra weight -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ---------- base reset ---------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
        }

        body {
            color: white;
            background: #0b0e14; /* fallback */
        }

        /* ---------- fixed navbar ---------- */
        nav {
            position: fixed;
            width: 100%;
            padding: 1.2rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(226, 226, 226, 0);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            z-index: 1000;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 2.2rem;
        }

        nav a {
            text-decoration: none;
            color: white;
            font-size: 0.95rem;
            padding-bottom: 4px;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s;
        }

        nav a:hover {
            border-bottom: 2px solid #ffbf48;
        }

        /* ---------- hero with background ---------- */
        .hero {
            height: 100vh;
            background: rgba(10, 15, 25, 0.65);
            background-attachment: fixed; /* subtle parallax */
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 1.5rem;
        }

        .overlay {
            background: rgba(10, 15, 25, 0.65);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            padding: 2.8rem 3rem;
            border-radius: 36px;
            max-width: 750px;
            width: 90%;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
            background: linear-gradient(130deg, #ffffff, #ffdb9e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h3 {
            font-weight: 350;
            font-size: 1rem;
            margin-bottom: 1.2rem;
            color: #e0e0e0;
            letter-spacing: 1px;
        }

        .hero p {
            font-size: 0.7rem;
            max-width: 500px;
            margin: 0 auto 2rem auto;
            opacity: 0.9;
        }

        /* ---------- chat row ---------- */
        .chat-input {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.6rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .input-wrapper {
            display: flex;
            flex: 1 1 280px;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 191, 72, 0.4);
            backdrop-filter: blur(10px);
            transition: box-shadow 0.2s;
        }
        .input-wrapper:focus-within {
            box-shadow: 0 0 0 3px rgba(255, 191, 72, 0.3);
        }

        .chat-input input {
            width: 100%;
            padding: 0.9rem 1.5rem;
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
            outline: none;
        }

        .chat-input input::placeholder {
            color: rgba(255, 255, 255, 0.6);
            font-weight: 300;
        }

        .chat-input button {
            background: #ffbf48;
            border: none;
            padding: 0.85rem 1.2rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            color: #0b0e14;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: 0.15s;
            box-shadow: 0 8px 18px rgba(255, 191, 72, 0.3);
            border: 1px solid transparent;
        }

        .chat-input button:hover {
            background: #ffad24;
            transform: scale(1.02);
            box-shadow: 0 12px 24px rgba(255, 175, 40, 0.5);
        }

        .chat-input button:active {
            transform: scale(0.98);
        }

        .chat-input button:disabled {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(0.6);
        }

        #voiceBtn {
            background: #f80808;
            color: white;
            box-shadow: 0 8px 18px rgba(0,0,0,0.4);
            padding: 0.85rem 1.3rem;
        }
        #voiceBtn:hover {
            background: #cc1212;
        }

        /* response area */
        #response {
            margin-top: 2rem;
            padding: 0.8rem 1.5rem;
            background: rgba(0, 0, 0, 0.35);
            border-radius: 10px;
            font-size: 1.1rem;
            min-height: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,191,72,0.3);
            backdrop-filter: blur(4px);
            color: #f0f0f0;
            transition: all 0.2s;
            white-space: pre-line; /* Allow line breaks in responses */
            text-align: left;
        }

        /* loading state inside response (simple) */
        .loading-dots {
            display: inline-flex;
            gap: 6px;
            align-items: center;
        }
        .loading-dots span {
            width: 8px;
            height: 8px;
            background: #ffbf48;
            border-radius: 50%;
            animation: pulse 1.2s infinite;
        }
        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes pulse {
            0%,100%{ opacity: 0.4; transform: scale(0.9); }
            50%{ opacity: 1; transform: scale(1.2); }
        }

        /* ---------- integrated Uiverse loader (masked sphere) ---------- */
        .custom-loader {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 110px;
            height: 110px;
            margin: 0 auto 1rem;
            transform: scale(0.9);
        }

        /* from Uiverse by andrew-manzyk — tiny adapt (prefix) */
        .loader {
            --color-one: #ffbf48;
            --color-two: #be4a1d;
            --color-three: #ffbf4780;
            --color-four: #bf4a1d80;
            --color-five: #ffbf4740;
            --time-animation: 2s;
            --size: 1.5; 
            position: relative;
            border-radius: 50%;
            transform: scale(var(--size));
            box-shadow: 0 0 25px 0 var(--color-three), 0 20px 50px 0 var(--color-four);
            animation: colorize calc(var(--time-animation) * 3) ease-in-out infinite;
            width: 100px;
            height: 100px;
        }

        .loader::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border-top: solid 1px var(--color-one);
            border-bottom: solid 1px var(--color-two);
            background: linear-gradient(180deg, var(--color-five), var(--color-four));
            box-shadow: inset 0 10px 10px 0 var(--color-three), inset 0 -10px 10px 0 var(--color-four);
        }

        .loader .box {
            width: 100px;
            height: 100px;
            background: linear-gradient(180deg, var(--color-one) 30%, var(--color-two) 70%);
            mask: url(#clipping);
            -webkit-mask: url(#clipping);
        }

        .loader svg {
            position: absolute;
            width: 100px;
            height: 100px;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .loader svg #clipping {
            filter: contrast(15);
            animation: roundness calc(var(--time-animation) / 2) linear infinite;
        }

        .loader svg #clipping polygon {
            filter: blur(7px);
        }

        .loader svg #clipping polygon:nth-child(1) {
            transform-origin: 75% 25%;
            transform: rotate(90deg);
        }
        .loader svg #clipping polygon:nth-child(2) {
            transform-origin: 50% 50%;
            animation: rotation var(--time-animation) linear infinite reverse;
        }
        .loader svg #clipping polygon:nth-child(3) {
            transform-origin: 50% 60%;
            animation: rotation var(--time-animation) linear infinite;
            animation-delay: calc(var(--time-animation) / -3);
        }
        .loader svg #clipping polygon:nth-child(4) {
            transform-origin: 40% 40%;
            animation: rotation var(--time-animation) linear infinite reverse;
        }
        .loader svg #clipping polygon:nth-child(5) {
            transform-origin: 40% 40%;
            animation: rotation var(--time-animation) linear infinite reverse;
            animation-delay: calc(var(--time-animation) / -2);
        }
        .loader svg #clipping polygon:nth-child(6) {
            transform-origin: 60% 40%;
            animation: rotation var(--time-animation) linear infinite;
        }
        .loader svg #clipping polygon:nth-child(7) {
            transform-origin: 60% 40%;
            animation: rotation var(--time-animation) linear infinite;
            animation-delay: calc(var(--time-animation) / -1.5);
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes roundness {
            0% { filter: contrast(15); }
            20% { filter: contrast(3); }
            40% { filter: contrast(3); }
            60% { filter: contrast(15); }
            100% { filter: contrast(15); }
        }
        @keyframes colorize {
            0% { filter: hue-rotate(0deg); }
            20% { filter: hue-rotate(-30deg); }
            40% { filter: hue-rotate(-60deg); }
            60% { filter: hue-rotate(-90deg); }
            80% { filter: hue-rotate(-45deg); }
            100% { filter: hue-rotate(0deg); }
        }

        /* small screen */
        @media (max-width: 600px) {
            nav { padding: 1rem 1.5rem; }
            nav ul { gap: 1.2rem; }
            h1 { font-size: 2.5rem; }
            .overlay { padding: 2rem 1.2rem; }
        }
    </style>
</head>
<body>

<!-- fixed navbar -->
<nav>
<ul>
    <li><a href="{% url 'home' %}"><i class="fas fa-house"></i> Home</a></li>
    <li><a href="{% url 'projects' %}"><i class="fas fa-code"></i> Projects</a></li>
    <li><a href="{% url 'about' %}"><i class="fas fa-user-astronaut"></i> About</a></li>
</ul>

<ul>
    <li>
        <a href="https://www.linkedin.com/in/nduduzo-nkosikhona-b28476321/" target="_blank">
            <i class="fab fa-linkedin"></i> LinkedIn
        </a>
    </li>

    <li>
        <a href="mailto:nntembe1212@gmail.com">
            <i class="fas fa-envelope-open-text"></i> Email
        </a>
    </li> 

    <li>
        <a href="#" onclick="copyPhoneNumber(event)">
            <i class="fas fa-phone-volume"></i> 071 556 5898
        </a>
    </li>    
</ul>

</nav>

<!-- hero + chat -->
<section class="hero">
    <div class="overlay">
        <!-- animated loader (masked sphere) from Uiverse, centered above name -->
        <div class="custom-loader">
            <div class="loader">
                <!-- inline SVG exactly from the prompt (mask definition) -->
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <defs>
                        <mask id="clipping">
                            <polygon points="0,0 100,0 100,100 0,100" fill="black"></polygon>
                            <polygon points="25,25 75,25 50,75" fill="white"></polygon>
                            <polygon points="50,25 75,75 25,75" fill="white"></polygon>
                            <polygon points="35,35 65,35 50,65" fill="white"></polygon>
                            <polygon points="35,35 65,35 50,65" fill="white"></polygon>
                            <polygon points="35,35 65,35 50,65" fill="white"></polygon>
                            <polygon points="35,35 65,35 50,65" fill="white"></polygon>
                        </mask>
                    </defs>
                </svg>
                <div class="box"></div>
            </div>
        </div>

        <h1>Nduduzo Nkosikhona</h1>
        <h3>Full Stack Developer · AI Integration · Mobile Apps</h3>
        <p>Building scalable web systems and AI-powered applications in South Africa.</p>

        <!-- response bubble (also shows loading with animated dots) -->
        <div id="response"></div>
        
        <div class="chat-input">
            <div class="input-wrapper">
                <input type="text" id="chatInput" placeholder="Ask about Nduduzo...">
                <button onclick="sendMessage()" id="sendBtn"><i class="fas fa-paper-plane" style="font-size: 1rem;"></i></button>
            </div>
            <button onclick="startVoice()" id="voiceBtn"><i class="fas fa-microphone"></i></button>
        </div>      
        
    </div>
</section>

<script>
(function() {
    // DOM elements
    const input = document.getElementById('chatInput');
    const responseDiv = document.getElementById('response');
    const sendBtn = document.getElementById('sendBtn');
    const voiceBtn = document.getElementById('voiceBtn');

    // speech recognition setup
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = SpeechRecognition ? new SpeechRecognition() : null;
    if (recognition) {
        recognition.lang = 'en-US';
        recognition.continuous = false;
        recognition.interimResults = false;
    }

    // Get CSRF token from cookie
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Function to normalize message text (fix common misspellings)
    function normalizeMessage(text) {
        return text
            .replace(/edu cation/gi, 'education')
            .replace(/eduction/gi, 'education')
            .replace(/edukation/gi, 'education')
            .replace(/skilz/gi, 'skills')
            .replace(/projec/gi, 'project')
            .replace(/expirience/gi, 'experience')
            .replace(/experiance/gi, 'experience')
            .replace(/technolgy/gi, 'technology')
            .replace(/programing/gi, 'programming');
    }

    // Main send message function - connects to Django backend
    window.sendMessage = function() {
        const message = input.value.trim();
        if (!message) return;

        // Show loading state
        responseDiv.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
        sendBtn.disabled = true;
        voiceBtn.disabled = true;
        input.disabled = true;

        // Prepare data for backend
        const csrftoken = getCookie('csrftoken');
        const url = '/chat/';  // Your Django chat endpoint
        
        // Normalize the message for better matching
        const normalizedMessage = normalizeMessage(message);

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({
                message: normalizedMessage,  // Send normalized version
                conversation_id: localStorage.getItem('conversation_id')
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                responseDiv.innerHTML = data.reply;
                speak(data.reply);
                
                // Store conversation ID for context
                if (data.conversation_id) {
                    localStorage.setItem('conversation_id', data.conversation_id);
                }
            } else {
                responseDiv.innerHTML = 'Error: ' + data.reply;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            responseDiv.innerHTML = 'Sorry, something went wrong. Please try again.';
        })
        .finally(() => {
            // Re-enable inputs
            sendBtn.disabled = false;
            voiceBtn.disabled = false;
            input.disabled = false;
            input.focus();
        });

        input.value = '';  // Clear input after sending
    };

    // Text-to-speech function
    function speak(text) {
        if (!window.speechSynthesis) return;
        
        // Remove markdown formatting for cleaner speech
        const cleanText = text.replace(/[*#]/g, '');
        
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(cleanText);
        utterance.lang = 'en-US';
        utterance.rate = 1;
        utterance.pitch = 1;
        window.speechSynthesis.speak(utterance);
    }

    // Voice input function
    window.startVoice = function() {
        if (!recognition) {
            responseDiv.innerHTML = 'Voice recognition not supported. Try Chrome, Edge, or Safari.';
            return;
        }
        
        responseDiv.innerHTML = '<span style="opacity:0.8;">🎙️ Listening...</span>';
        recognition.start();

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            input.value = transcript;
            window.sendMessage();  // Auto-send after voice input
        };

        recognition.onerror = (e) => {
            responseDiv.innerHTML = 'Voice error: ' + e.error;
            console.warn(e);
        };

        recognition.onend = () => {
            if (responseDiv.innerHTML.includes('🎙️ Listening')) {
                responseDiv.innerHTML = 'Didn\'t catch that. Tap mic again.';
            }
        };
    };

    // Press Enter to send
    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            window.sendMessage();
        }
    });

    // Initialize conversation ID on load
    window.addEventListener('load', () => {
        if (!localStorage.getItem('conversation_id')) {
            localStorage.setItem('conversation_id', Date.now().toString());
        }
        input.focus();
        
        // Welcome message
        setTimeout(() => {
            responseDiv.innerHTML = '👋 Hi! I\'m Nduduzo\'s AI assistant. Ask or interview me about his skills, projects, education, or more!';
        }, 500);
    });
})();
function copyPhoneNumber(event) {
    event.preventDefault();
    
    const phoneNumber = "0715565898";
    
    navigator.clipboard.writeText(phoneNumber).then(() => {
        alert("Phone number copied to clipboard!");
    }).catch(err => {
        console.error("Failed to copy: ", err);
    });
}
</script>
</body>
</html>